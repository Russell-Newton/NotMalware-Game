package whatexe.dungeoncrawler.music;

import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;

import java.util.HashMap;
import java.util.Map;

public class MusicManager {

    private static MusicManager instance;

    private final Map<String, MediaPlayer> mediaPlayerMap;
    private boolean isInTest;

    private MusicManager() {
        mediaPlayerMap = new HashMap<>();
    }

    public static MusicManager getInstance() {
        if (instance == null) {
            instance = new MusicManager();
        }
        return instance;
    }

    public MediaPlayer addTrack(String songName) {
        if (mediaPlayerMap.containsKey(songName)) {
            throw new RuntimeException(
                    String.format("MusicManager already contains the track '%s'!", songName));
        }
        MediaPlayer newPlayer = new MediaPlayer(
                new Media(getClass().getResource(songName + ".mp3").toString()));
        newPlayer.setCycleCount(Integer.MAX_VALUE);
        if (!isInTest) {
            mediaPlayerMap.put(songName, newPlayer);
        }
        return newPlayer;
    }

    public void removeTrack(String songName) {
        if (!isInTest) {
            if (!mediaPlayerMap.containsKey(songName)) {
                throw new RuntimeException(
                        String.format("MusicManager doesn't contain the track '%s'!", songName));
            }
            mediaPlayerMap.get(songName).dispose();
            mediaPlayerMap.remove(songName);
        }
    }

    public void playTrack(String songName) {
        if (!isInTest) {
            if (!mediaPlayerMap.containsKey(songName)) {
                throw new RuntimeException(
                        String.format("MusicManager doesn't contain the track '%s'!", songName));
            }
            mediaPlayerMap.get(songName).play();
        }
    }

    public void pauseTrack(String songName) {
        if (!isInTest) {
            if (!mediaPlayerMap.containsKey(songName)) {
                throw new RuntimeException(
                        String.format("MusicManager doesn't contain the track '%s'!", songName));
            }
            mediaPlayerMap.get(songName).pause();
        }
    }

    public void stopTrack(String songName) {
        if (!isInTest) {
            if (!mediaPlayerMap.containsKey(songName)) {
                throw new RuntimeException(
                        String.format("MusicManager doesn't contain the track '%s'!", songName));
            }
            mediaPlayerMap.get(songName).stop();
        }
    }

    public void stopAllTracks() {
        for (String song : mediaPlayerMap.keySet()) {
            stopTrack(song);
        }
    }

    public Map<String, MediaPlayer> getMediaPlayerMap() {
        return mediaPlayerMap;
    }

    public void setInTest(boolean inTest) {
        isInTest = inTest;
    }
}
