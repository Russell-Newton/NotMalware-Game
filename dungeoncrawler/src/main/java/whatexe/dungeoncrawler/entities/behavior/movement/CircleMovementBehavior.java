package whatexe.dungeoncrawler.entities.behavior.movement;

import javafx.geometry.Rectangle2D;
import whatexe.dungeoncrawler.entities.Entity;
import whatexe.dungeoncrawler.entities.motionsupport.Vector;

public class CircleMovementBehavior extends MovementBehavior<Entity> {
    private Entity targetEntity;
    private Rectangle2D lastHBLocation;

    public CircleMovementBehavior(Entity owningEntity, Entity targetEntity) {
        super(owningEntity);
        this.targetEntity = targetEntity;
        lastHBLocation = targetEntity.getHitbox();
    }

    @Override
    public Vector getMovement() {
        double speed = owningEntity.getEntityStatistics().getModifiedSpeed();
        Vector direction;
        Vector outwardVector = targetEntity.vectorToOtherEntity(owningEntity);
        if (targetEntity.getDisplayNode().getParent() == null) {
            outwardVector = Vector.vectorToOtherHitbox(lastHBLocation, owningEntity.getHitbox());
            direction = Vector.rotateBy(outwardVector, Math.PI / 2 - .3).unit();
        } else {
            direction = Vector.rotateBy(outwardVector, Math.PI / 2).unit();
        }
        return direction.scaledBy(speed);
    }
}
