package whatexe.dungeoncrawler.entities.behavior.death;

import whatexe.dungeoncrawler.entities.Entity;
import whatexe.dungeoncrawler.entities.EntityChooser;
import whatexe.dungeoncrawler.entities.items.Item;

/**
 * Includes the chance to drop an item after death.
 */
public class ItemDropDeathBehavior extends RemoveOnDeathBehavior {

    protected final double dropChance;
    protected final boolean includeModifiers;

    public ItemDropDeathBehavior(Entity owningEntity, double dropChance, boolean includeModifiers) {
        super(owningEntity);

        this.dropChance = dropChance;
        this.includeModifiers = includeModifiers;
    }

    @Override
    public void die() {
        if (Math.random() < dropChance) {

            Item drop = EntityChooser.getInstance()
                                     .getRandomItem(owningEntity.getOwningRoom().getPlayer(),
                                                    includeModifiers);
            drop.setEntityPosition(owningEntity.getDisplayNode().getTranslateX(),
                                   owningEntity.getDisplayNode().getTranslateY());

            owningEntity.getOwningRoom().addEntity(drop);
        }
        super.die();
    }
}
