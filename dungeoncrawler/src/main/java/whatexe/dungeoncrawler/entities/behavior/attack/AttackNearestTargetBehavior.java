package whatexe.dungeoncrawler.entities.behavior.attack;

import whatexe.dungeoncrawler.entities.Entity;
import whatexe.dungeoncrawler.entities.motionsupport.Vector;

import java.util.List;
import java.util.function.Supplier;
import java.util.stream.Collectors;

public abstract class AttackNearestTargetBehavior<T extends Entity> extends AttackBehavior<Entity> {

    private final Supplier<List<T>> targetsSuppler;
    protected int ticksSinceAttack;

    public AttackNearestTargetBehavior(Entity owningEntity, Supplier<List<T>> targetsSuppler) {
        super(owningEntity);

        this.targetsSuppler = targetsSuppler;
    }

    @Override
    public List<? extends Entity> getDefaultAttackEntities() {
        return targetsSuppler.get();
    }

    @Override
    protected void setAttackDirection() {
        List<T> targets = targetsSuppler.get();
        if (targets.size() == 0) {
            attackDirection = new Vector(0, 0);
            return;
        }

        Entity target = targets.stream().sorted((o1, o2) -> {
            if (o1.equals(o2)) {
                return 0;
            }
            if (owningEntity.vectorToOtherEntity(o1).magnitude()
                    - owningEntity.vectorToOtherEntity(o2).magnitude() < 0) {
                return -1;
            }
            return 1;
        }).collect(Collectors.toList()).get(0);

        attackDirection = owningEntity.vectorToOtherEntity(target);
    }


}
