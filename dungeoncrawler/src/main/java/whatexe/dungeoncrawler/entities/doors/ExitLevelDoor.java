package whatexe.dungeoncrawler.entities.doors;

import javafx.scene.Node;
import javafx.scene.shape.Shape;
import whatexe.dungeoncrawler.MainApp;
import whatexe.dungeoncrawler.entities.Entity;
import whatexe.dungeoncrawler.entities.behavior.overlap.DoorOverlapBehavior;
import whatexe.dungeoncrawler.layout.Level;
import whatexe.dungeoncrawler.layout.rooms.Room;

import java.io.IOException;

public class ExitLevelDoor extends SimpleDoor {

    private static final Node DEFAULT_NODE = null;

    public ExitLevelDoor(Node displayNode,
                         Level owningLevel,
                         Shape hitbox,
                         Room owningRoom) {
        super(displayNode, owningLevel, null, hitbox, owningRoom);
        canTick = true;

        getBehaviorSet().setOverlapBehavior(new DoorOverlapBehavior(this) {
            @Override
            public void handleOverlap(Entity otherEntity) {
                attemptLeave();
            }
        });
    }

    public ExitLevelDoor(Node displayNode,
                         Level owningLevel,
                         Room owningRoom) {
        super(displayNode, owningLevel, null, owningRoom);
        canTick = true;
    }

    public ExitLevelDoor(Level owningLevel, Room owningRoom) {
        super(DEFAULT_NODE, owningLevel, null, owningRoom);
        canTick = true;
    }

    public void attemptLeave() {
        if (!isLocked.get()) {
            try {
                MainApp.switchScene("EndScreen");
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
