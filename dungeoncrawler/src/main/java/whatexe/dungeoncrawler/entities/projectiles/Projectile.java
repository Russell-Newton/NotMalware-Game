package whatexe.dungeoncrawler.entities.projectiles;

import javafx.scene.shape.Circle;
import whatexe.dungeoncrawler.entities.Entity;
import whatexe.dungeoncrawler.entities.behavior.BehaviorSet;
import whatexe.dungeoncrawler.entities.behavior.DoNothing;
import whatexe.dungeoncrawler.entities.behavior.death.RemoveOnDeathBehavior;
import whatexe.dungeoncrawler.entities.behavior.movement.SimpleMovementBehavior;
import whatexe.dungeoncrawler.entities.motionsupport.Vector;
import whatexe.dungeoncrawler.layout.rooms.Room;

public abstract class Projectile extends Entity {

    protected final int damage;
    protected int lifetime;

    public Projectile(Room owningRoom, int speed, Vector direction, int damage, int lifetime) {
        super(new Circle(2), owningRoom);
        this.damage = damage;
        this.lifetime = lifetime;
        canTick = true;

        behaviorSet.set(new BehaviorSet(new DoNothing(),
                                        new SimpleMovementBehavior(this, direction, speed),
                                        new RemoveOnDeathBehavior(this)));

    }

    public Projectile(Room owningRoom, int speed, Vector direction, int damage) {
        this(owningRoom, speed, direction, damage, Integer.MAX_VALUE);
    }

    public void handleOnEntityCollision(Entity other) {
        setHealth(-1);
    }

    @Override
    public void handleOnBoundaryCollision() {
        setHealth(-1);
    }

    public double getSpeed() {
        return getBehaviorSet().getCastedMovementBehavior(SimpleMovementBehavior.class).getSpeed();
    }

    public void setSpeed(int speed) {
        getBehaviorSet().getCastedMovementBehavior(SimpleMovementBehavior.class).setSpeed(speed);
    }

    @Override
    public void tick() {
        super.tick();
        lifetime--;
        if (lifetime <= 0) {
            setHealth(-1);
        }
    }
}
