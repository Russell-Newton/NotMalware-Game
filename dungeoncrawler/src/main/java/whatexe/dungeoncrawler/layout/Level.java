package whatexe.dungeoncrawler.layout;

import java.util.HashMap;
import java.util.Map;

public class Level {

    private final RoomPositionProperty currentRoomPosition;
    private Map<RoomPosition, Room> maze;

    public Level() {
        this(new RoomPosition(0, 0));
    }

    public Level(RoomPosition startingRoomPosition) {
        currentRoomPosition = new RoomPositionProperty(startingRoomPosition);
        maze = new HashMap<>();
    }

    public Room moveUp() {
        currentRoomPosition.set(currentRoomPosition.get().getAbove());
        return getCurrentRoom();
    }

    public Room getCurrentRoom() {
        return maze.get(currentRoomPosition.get());
    }

    public Room moveDown() {
        currentRoomPosition.set(currentRoomPosition.get().getBelow());
        return getCurrentRoom();
    }

    public Room moveLeft() {
        currentRoomPosition.set(currentRoomPosition.get().getLeft());
        return getCurrentRoom();
    }

    public Room moveRight() {
        currentRoomPosition.set(currentRoomPosition.get().getRight());
        return getCurrentRoom();
    }

    public Map<RoomPosition, Room> getMaze() {
        return maze;
    }

    public RoomPositionProperty currentRoomPositionProperty() {
        return currentRoomPosition;
    }

    public String mazeToString() {
        int minX = 0;
        int maxX = 0;
        int minY = 0;
        int maxY = 0;

        for (RoomPosition position : maze.keySet()) {
            minX = Math.min(minX, position.getX());
            minY = Math.min(minY, position.getY());
            maxX = Math.max(maxX, position.getX());
            maxY = Math.max(maxY, position.getY());
        }

        String[][] mazeRep = new String[maxY - minY + 1][maxX - minX + 1];
        for (Map.Entry<RoomPosition, Room> entry : maze.entrySet()) {
            RoomPosition position = entry.getKey();
            Room room = entry.getValue();
            if (position.equals(currentRoomPosition.get())) {
                mazeRep[position.getY() - minY][position.getX() - minX] = "C";
            } else {
                mazeRep[position.getY() - minY][position.getX() - minX] = room.getClass()
                                                                              .getSimpleName();
            }
        }

        StringBuilder builder = new StringBuilder();
        for (String[] row : mazeRep) {
            for (String room : row) {
                if (room == null) {
                    builder.append(" ");
                } else {
                    builder.append(room.charAt(0));
                }
            }
            builder.append("\n");
        }

        return builder.toString();
    }
}
