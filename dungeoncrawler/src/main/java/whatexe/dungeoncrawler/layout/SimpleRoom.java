package whatexe.dungeoncrawler.layout;

import javafx.scene.control.Button;
import whatexe.dungeoncrawler.entities.SimpleDoor;
import whatexe.tileengine.MapObject;
import whatexe.tileengine.TiledMap;

import java.util.Collections;
import java.util.Comparator;
import java.util.List;

public class SimpleRoom extends Room {

    public SimpleRoom(TiledMap fromTiledMap,
                      Level owningLevel,
                      Direction... directionsToGenerate) {
        super(fromTiledMap, owningLevel, directionsToGenerate);
    }

    @Override
    protected void initDoors(Direction[] directionsToGenerate) {
        List<MapObject> doorMapObject = fromTiledMap.getObjectGroups().get("Doors").getObjects();
        Collections.sort(doorMapObject, new MapObjectComparator());

        for (Direction direction : directionsToGenerate) {
            MapObject correspondingDoor;
            Button button = new Button(direction.toString());
            switch (direction) {
            case UP:
                correspondingDoor = doorMapObject.get(0);
                button.setOnAction(event -> owningLevel.moveUp());
                break;
            case LEFT:
                correspondingDoor = doorMapObject.get(1);
                button.setOnAction(event -> owningLevel.moveLeft());
                break;
            case RIGHT:
                correspondingDoor = doorMapObject.get(2);
                button.setOnAction(event -> owningLevel.moveRight());
                break;
            case DOWN:
                correspondingDoor = doorMapObject.get(3);
                button.setOnAction(event -> owningLevel.moveDown());
                break;
            default:
                throw new RuntimeException("Did not initialize doors with Direction enums");
            }
            button.setId(direction.toString());
            button.setTranslateX(correspondingDoor.getX());
            button.setTranslateY(correspondingDoor.getY());
            button.setPrefWidth(correspondingDoor.getWidth());
            button.setPrefHeight(correspondingDoor.getHeight());
            // button.resize(correspondingDoor.getWidth(), correspondingDoor.getHeight());
            doors.add(new SimpleDoor(button, owningLevel, direction));
        }
    }

    @Override
    protected void initEntities() {

    }

    class MapObjectComparator implements Comparator<MapObject> {

        @Override
        public int compare(MapObject o1, MapObject o2) {
            if (o1.getY() < o2.getY()) {
                return -1;
            } else if (o1.getY() == o2.getY()) {
                if (o1.getX() < o2.getX()) {
                    return -1;
                } else {
                    return 1;
                }
            } else {
                return 1;
            }
        }
    }

}
