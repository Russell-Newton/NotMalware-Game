package whatexe.dungeoncrawler;

import javafx.application.Application;
import javafx.stage.Stage;

import java.io.IOException;
import java.util.Map;

public class MainApp extends Application {

    private static Stage primaryStage;
    private static String currentScene;

    public static void main(String[] args) {
        launch(args);
    }

    @Override
    public void start(Stage primaryStage) throws IOException {
        // Scene root = new Scene(new AnchorPane(), 600, 600);

        SceneManager.getInstance().addScene("Scene A",
                                            getClass().getResource("controllers"
                                                                           +
                                                                           "/AController.fxml"));

        SceneManager.getInstance().addScene("Scene B",
                                            getClass().getResource("controllers"
                                                                           +
                                                                           "/BController.fxml"));

        MainApp.primaryStage = primaryStage;
        primaryStage.setTitle("What.exe Dungeon Crawler");

        switchScene("Scene A");

        primaryStage.show();
    }

    /**
     * Switches to a new scene. Loads the new scene and unloads the current (if present) scene.
     *
     * @param sceneName the name of the new scene, as held in the {@link SceneManager}.
     * @throws IOException if the FXML file saved in the {@link SceneManager} cannot be loaded.
     * @see MainApp#switchScene(String, Map)
     * @see SceneManager
     * @see SceneManager#loadScene(String)
     * @see SceneManager#unloadScene(String)
     */
    public static void switchScene(String sceneName) throws IOException {
        switchScene(sceneName, Map.of());
    }

    /**
     * Switches to a new scene. Loads the new scene and unloads the current (if present) scene.
     *
     * @param sceneName      the name of the new scene, as held in the {@link SceneManager}.
     * @param loadParameters optional parameters passed into the {@link ManagedController}'s
     *                       {@link ManagedController#init} method.
     * @throws IOException if the FXML file saved in the {@link SceneManager} cannot be loaded.
     * @see SceneManager
     * @see SceneManager#loadScene(String, Map)
     * @see SceneManager#unloadScene(String)
     * @see ManagedController#init(Map)
     */
    public static void switchScene(String sceneName, Map<String, ?> loadParameters)
            throws IOException {
        // System.out.println("Loading and switching to " + sceneName);

        // Set the primaryStage scene to the new scene
        primaryStage.setScene(SceneManager.getInstance().loadScene(sceneName, loadParameters));
        if (currentScene != null) {
            // System.out.println("Unloading " + currentScene);

            // Unload the current scene from
            SceneManager.getInstance().unloadScene(currentScene);
        }

        currentScene = sceneName;
    }
}
